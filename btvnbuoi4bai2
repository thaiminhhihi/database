--1. Táº¡o cÆ¡ sá»Ÿ dá»¯ liá»‡u quáº£n lÃ½ nhÃ  trá» gá»“m cÃ¡c báº£ng sau
--Chá»§ trá» (landlords):  
--id: khÃ³a chÃ­nh tá»± tÄƒng
--fullname: nvarchar(50) not null
--address: nvarchar(200)

create table landlords (
id int primary key identity (1,1),
fullname nvarchar(50) not null,
address nvarchar(200)
)
--PhÃ²ng trá» (rooms):
--id: khÃ³a chÃ­nh tá»± tÄƒng
--landlord_id: chá»§ trá» (liÃªn káº¿t vá»›i báº£ng landlords)
--room_number: nvarchar(20) not null
--price: float
create table rooms (
id int primary key identity (1,1),
landlord_id int foreign key references landlords(id),
room_number nvarchar(20) not null,
price float )

--KhÃ¡ch thuÃª (tenants):
--id: khÃ³a chÃ­nh tá»± tÄƒng
--fullname: nvarchar(50) not null
--phone: nvarchar(20)
--email: nvarchar(150)
CREATE TABLE tenants (
    id INT IDENTITY(1,1) PRIMARY KEY,
    fullname NVARCHAR(50) NOT NULL,
    phone NVARCHAR(20),
    email NVARCHAR(150) )
alter table landlords add phone nvarchar(20)

select * from landlords
select * from rooms
select * from tenants
select * from contracts
--Há»£p Ä‘á»“ng thuÃª (contracts):
--id: khÃ³a chÃ­nh tá»± tÄƒng
--tenant_id: khÃ¡ch thuÃª (liÃªn káº¿t vá»›i báº£ng tenants)
--room_id: phÃ²ng thuÃª (liÃªn káº¿t vá»›i báº£ng rooms)
--start_date: datetime
--end_date: datetime
create table contracts (
id int primary key identity (1,1),
tenant_id int foreign key references tenants(id),
room_id int foreign key references rooms(id),
start_date datetime,
end_date datetime)
--Dá»¯ liá»‡u máº«u cáº§n thÃªm
INSERT INTO landlords (fullname, phone, address)
VALUES 
(N'Nguyá»…n VÄƒn A',N'HÃ  Ná»™i','0911111111'),
(N'Tráº§n VÄƒn B',N'Nam Äá»‹nh','0922222222'),
(N'LÃª Thá»‹ C',N'ThÃ¡i BÃ¬nh','0933333333');

-- PhÃ²ng trá»
INSERT INTO rooms (room_number, price, landlord_id)
VALUES
(N'PhÃ²ng 101',1500000,1),
(N'PhÃ²ng 102',1800000,1),
(N'PhÃ²ng 201',2000000,2),
(N'PhÃ²ng 301',2500000,3);

-- KhÃ¡ch thuÃª
INSERT INTO tenants (fullname, phone, email)
VALUES
(N'Pháº¡m VÄƒn D','0988888888','d@gmail.com'),
(N'Nguyá»…n VÄƒn E','0977777777','e@gmail.com'),
(N'Tráº§n Thá»‹ F','0966666666','f@gmail.com');

-- Há»£p Ä‘á»“ng thuÃª
INSERT INTO contracts (tenant_id, room_id, start_date, end_date)
VALUES
(1,1,'2025-01-01','2025-12-31'),
(2,2,'2025-03-01','2025-09-01'),
(3,3,'2025-05-15','2025-11-15');
--Chá»§ trá» (landlords):
--Nguyá»…n VÄƒn A, 0911111111, HÃ  Ná»™i
--Tráº§n VÄƒn B, 0922222222, Nam Äá»‹nh
--LÃª Thá»‹ C, 0933333333, ThÃ¡i BÃ¬nh

--PhÃ²ng trá» (rooms):
--PhÃ²ng 101, giÃ¡ 1.500.000, thuá»™c chá»§ trá» id = 1
--PhÃ²ng 102, giÃ¡ 1.800.000, thuá»™c chá»§ trá» id = 1
--PhÃ²ng 201, giÃ¡ 2.000.000, thuá»™c chá»§ trá» id = 2
--PhÃ²ng 301, giÃ¡ 2.500.000, thuá»™c chá»§ trá» id = 3

--KhÃ¡ch thuÃª (tenants):
--Pháº¡m VÄƒn D, 0988888888, d@gmail.com
--Nguyá»…n VÄƒn E, 0977777777, e@gmail.com
--Tráº§n Thá»‹ F, 0966666666, f@gmail.com

--Há»£p Ä‘á»“ng thuÃª (contracts):
--KhÃ¡ch id = 1 thuÃª phÃ²ng id = 1, tá»« 2025-01-01 Ä‘áº¿n 2025-12-31
--KhÃ¡ch id = 2 thuÃª phÃ²ng id = 2, tá»« 2025-03-01 Ä‘áº¿n 2025-09-01
--KhÃ¡ch id = 3 thuÃª phÃ²ng id = 3, tá»« 2025-05-15 Ä‘áº¿n 2025-11-15\

--CÃ¡c yÃªu cáº§u:
--YÃŠU Cáº¦U 1:
--Láº¥y danh sÃ¡ch táº¥t cáº£ khÃ¡ch thuÃª vÃ  thÃ´ng tin há»£p Ä‘á»“ng (náº¿u cÃ³).
--Format:
--tenant_id, fullname, phone, email, contract_id, room_id, start_date, end_date
--ğŸ‘‰ Gá»£i Ã½: sá»­ dá»¥ng LEFT JOIN
SELECT 
    t.id AS tenant_id,
    t.fullname,
    t.phone,
    t.email,
    c.id AS contract_id,
    c.room_id,
    c.start_date,
    c.end_date
FROM tenants t
LEFT JOIN contracts c ON t.id = c.tenant_id;
select * from landlords
select * from rooms
select * from tenants
select * from contracts
--YÃŠU Cáº¦U 2:
--Láº¥y danh sÃ¡ch táº¥t cáº£ há»£p Ä‘á»“ng cÃ¹ng thÃ´ng tin khÃ¡ch thuÃª.
--Format:
--contract_id, tenant_name, tenant_phone, room_number, start_date, end_date
--ğŸ‘‰ Gá»£i Ã½: sá»­ dá»¥ng INNER JOIN
select 
c.id,
t.fullname,
t.phone,
r.room_number,
c.start_date,
c.end_date
from contracts c
inner join tenants t on c.tenant_id = t.id
inner join rooms r on c.room_id = r.id



--YÃŠU Cáº¦U 3:
--Láº¥y táº¥t cáº£ phÃ²ng trá» vÃ  thÃ´ng tin chá»§ trá» kÃ¨m theo.
--Format:
--room_id, room_number, price, landlord_name, landlord_phone
--ğŸ‘‰ Gá»£i Ã½: sá»­ dá»¥ng JOIN
select 
r.id as room_id,
r.room_number, 
r.price ,
l.fullname,
l.phone
from rooms r
join landlords l on l.id = r.landlord_id
select * from landlords
select * from rooms
select * from tenants
select * from contracts
--YÃŠU Cáº¦U 4:
--Láº¥y danh sÃ¡ch khÃ¡ch thuÃª chÆ°a cÃ³ há»£p Ä‘á»“ng.
--ğŸ‘‰ Gá»£i Ã½: sá»­ dá»¥ng LEFT JOIN + WHERE contract_id IS NULL
SELECT 
    t.id AS tenant_id,
    t.fullname,
    t.phone,
    t.email,
    c.id
FROM tenants t
LEFT JOIN contracts c ON t.id = c.tenant_id
WHERE c.id IS NULL;

--YÃŠU Cáº¦U 5:
--Láº¥y danh sÃ¡ch chá»§ trá» vÃ  táº¥t cáº£ phÃ²ng trá» (ká»ƒ cáº£ khi chÆ°a cÃ³ phÃ²ng nÃ o Ä‘Æ°á»£c thÃªm).
--ğŸ‘‰ Gá»£i Ã½: sá»­ dá»¥ng FULL OUTER JOIN
select 
l.id,
l.fullname,
l.address,
l.phone,
r.id,
r.landlord_id,
r.room_number,
r.price
from landlords l
full outer join rooms r on l.id = r.landlord_id
--YÃŠU Cáº¦U 6:
--Hiá»ƒn thá»‹ danh sÃ¡ch khÃ¡ch thuÃª sáº¯p xáº¿p theo tÃªn (fullname) tÄƒng dáº§n vÃ  theo id giáº£m dáº§n.
select * from tenants order by fullname asc , id desc
